@docs/goal.md 를 읽고 해야할 작업을 정확하게 파악한 뒤에, 이 작업을 효율적으로 하기위한 claude sub agent 정의 계획을 세워주세요.

어떤 sub agent가 있으면 좋을지, 해당 sub agent들을 활용하기위해 어떤 프롬프트를 입력해야할지 설계하세요.

주요 목표:
- 여러 sub agent를 동시에 병렬로 실행하여, 작업 시간을 단축한다.
- 탐색 등 context 소모가 많은 작업들을, planning sub agent에게 위임하여 context 소모를 줄이고 결과물만 응답받는다.
- 여러번 반복이 필요한 typecheck, lint, build, test 등의 작업을 Haiku 모델을 사용하는 sub agent를 통해 빠르게 수행한다.
- 정확한, 고품질 코드 구현이 필요한 작업은 sonnet 모델을 사용하는 sub agent를 통해 조금 느리더라도 고품질로 수행한다. 

---

너가 세운 계획을 다음 프롬프트로 피드백하려고해. 내 의도를 이해하고, 더 좋은 피드백을 받기위한 개선된 프롬프트를 제안해줘.

```
다음과 같은 순서로 서브에이전트 구현계획을 엄격하게 비판하라.

1. `npx repomix --ignore "./**/*.md` 명령어를 사용하여 전체 코드베이스 내용을 `repomix-output.xml` 파일로 만든 뒤, 이 파일을 한번에 통째로 읽어 전체 코드베이스 내용을 이해한다.
2. docs/goal.md 파일을 읽고, 작업 목표와 주의사항, 작업지침을 정확하게 이해한다.
3. agent-plan.md 파일을 읽고, 제안된 서브에이전트 계획을 정확하게 이해한다.
4. 제안된 계획에 대해 다음과 같이 피드백한다.
    - 병렬로 수행되는 작업간의 충돌은 없는가?
    - 클로드코드의 기본 에이전트(Task, Plan)보다 우리 프로젝트에 최적화된 시스템프롬프트를 갖춘 서브에이전트를 적절히 정의했는가? 기본 에이전트와의 차별성은 얼마나 확보되는가?
    - 설계 에이전트의 결과물이 요구사항을 정확히 구현하며, 간결하게 확장성있는 코드임을 보증하기위해, 여러 단계로 자가개선 및 피드백 루프가 마련되어있는가?
    - 설계가 정확히 구현되었음을 보증하기위한 절차가 마련되었는가?
```

---

# Sub Agent 계획 비판 및 개선 제안 요청

다음 순서로 서브에이전트 구현 계획을 **심층 분석**하고 **구체적 개선안**을 제시하라.
루트 경로에 agent-enhance-plan.md 파일로 결과물을 작성하라.

## Phase 1: 코드베이스 및 요구사항 완전 이해

1. **전체 코드베이스 분석**
   - 실행: `npx repomix --ignore "./**/*.md"`
   - repomix-output.xml 파일을 읽고 다음을 파악:
     - 현재 아키텍처 패턴 (디렉토리 구조, 모듈 분리, 의존성)
     - 기존 tool 구현 방식 (타입 정의, 에러 처리, 테스트 패턴)
     - createTossPaymentDocsRepository의 세부 구현
     - 빌드/테스트 설정 (package.json, tsconfig.json)

2. **요구사항 정밀 파악**
   - docs/goal.md 읽고 분석:
     - 5가지 작업의 기술적 의존관계 파악
     - 주의사항의 구현 영향도 분석
     - 테스트 요구사항의 범위 해석

3. **현재 계획 이해**
   - agent-plan.md 읽고 분석:
     - 7개 에이전트의 역할과 의존성
     - 각 에이전트 프롬프트의 구체성 수준
     - Phase별 병렬/순차 실행 전략

## Phase 2: 다각도 비판 (우선순위순)

### 🔴 Critical: 계획 실행 가능성 검증

1. **병렬 실행 안전성**
   - Phase 1에서 Agent 1, 2, 3이 동시 실행될 때:
     - 파일 읽기 충돌 가능성은?
     - 결과물의 일관성 보장 방법은?
   - Phase 2에서 Agent 4, 5가 동시에 코드 수정할 때:
     - 같은 파일 편집 충돌 가능성은? (예: tools.ts)
     - Git merge conflict 발생 시나리오는?
   - **구체적 충돌 시나리오**와 **해결 방안** 제시

2. **에이전트 간 의존성 및 데이터 전달**
   - Phase 1 결과를 Phase 2가 어떻게 받는가?
   - 에이전트 간 context 전달이 명시적으로 계획되었는가?
   - 중간 결과물 저장 방식은? (파일? 메모리?)

3. **실패 시나리오 대응**
   - Agent 7 검증 루프가 10회 반복해도 실패하면?
   - Phase 2에서 한 에이전트만 실패하면 전체 재실행?
   - 각 Phase별 롤백 전략이 구체적인가?

### 🟡 High: 계획 최적성 검증

4. **커스텀 에이전트 vs 기본 에이전트**
   - 제안된 7개 에이전트가 Task/Plan/Explore보다 나은 이유는?
   - 각 에이전트의 시스템 프롬프트가 이 프로젝트에 특화되었는가?
   - 차별화 포인트:
     - 도메인 지식 주입 여부 (MCP 서버 구조, llms.txt 파싱)
     - 제약사항 명시 여부 (tosspayments 하위호환성)
     - 출력 형식 표준화 여부
   - **구체적 개선안**: 각 에이전트에 추가할 프로젝트별 컨텍스트 제시

5. **설계 품질 보증 메커니즘**
   - Agent 3 (설계)의 출력물 품질을 누가 검증?
   - 설계 리뷰 루프가 있는가? (예: 설계 → 검토 → 개선 → 재검토)
   - 설계가 다음 요구사항을 만족하는지 체크리스트가 있는가?
     - 타입 안전성
     - 확장성 (새 라이브러리 추가 용이성)
     - 하위 호환성
     - 에러 처리 완전성
   - **구체적 개선안**: 설계 검증 체크리스트 및 피드백 루프 설계

6. **구현 정확성 보증**
   - Agent 4, 5가 Agent 3 설계를 정확히 따랐는지 검증 방법은?
   - 설계-구현 일치성 검증 에이전트가 필요한가?
   - 코드 리뷰 단계가 누락되지 않았는가?

### 🟢 Medium: 효율성 및 비용 최적화

7. **모델 선택의 적절성**
   - Agent 3 (설계)는 정말 Sonnet이 필요한가? (간단한 인터페이스 설계)
   - Agent 6 (테스트 작성)은 Haiku로 충분한가? (복잡한 edge case)
   - **ROI 분석**: 각 에이전트의 모델 선택이 비용 대비 가치가 있는가?

8. **Phase 분리의 효율성**
   - Phase 1과 2를 완전히 분리해야 하는가?
   - Agent 4와 5가 정말 독립적인가? (tools.ts 공유 가능성)
   - 더 나은 Phase 분할 방법은?

9. **Context 사용 최적화**
   - Explore 에이전트가 정말 context를 절약하는가?
   - repomix-output.xml을 미리 읽는 것과 비교한 context 소모량은?
   - 불필요한 중복 탐색은 없는가?

### 🔵 Low: 기타 개선사항

10. **테스트 전략 완전성**
    - 통합 테스트는 누가 작성하는가?
    - 실제 llms.txt URL로 E2E 테스트가 필요하지 않은가?

11. **문서화 및 유지보수성**
    - 각 에이전트 결과물의 문서화 요구사항은?
    - 향후 새 라이브러리 추가 시 가이드는?

## Phase 3: 종합 개선안 제시

위 분석을 바탕으로:

1. **우선순위별 개선 항목** (Critical > High > Medium)
2. **수정된 에이전트 계획**
   - 추가/삭제/병합할 에이전트
   - 수정된 Phase 구조
   - 개선된 프롬프트 (상위 3개 에이전트만)
3. **실행 가능성 점수** (1-10) 및 근거
4. **예상 개선 효과**
   - 시간 변화
   - 비용 변화
   - 품질 향상도

## 출력 형식

```markdown
# Sub Agent 계획 비판 보고서

## Executive Summary
- 현재 계획의 치명적 문제점 (Top 3)
- 핵심 개선 방향 (한 문장)

## Critical Issues (🔴)
[각 이슈별로 상세 분석]

## High Priority Issues (🟡)
[각 이슈별로 상세 분석]

## Medium Priority Issues (🟢)
[각 이슈별로 상세 분석]

## Low Priority Issues (🔵)
[각 이슈별로 상세 분석]

## 개선된 Agent Plan v2
[구체적 수정안]

## 실행 권고사항
- 즉시 수정 필요: [...]
- 선택적 개선: [...]
```
